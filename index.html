<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STO373 Goods Arrival Plan Search</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #2c3e50;
            --accent-blue: #3498db;
            --bg-light: #f4f7f6;
            --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: var(--primary-blue);
            font-size: 24px;
        }

        /* ê²€ìƒ‰ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .search-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--box-shadow);
            border-top: 5px solid #3498db;
        }

        .info-box {
            background-color: #f1c40f; /* ë…¸ë€ìƒ‰ ë°°ê²½ */
            color: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: 0.3s;
        }

        .btn-search { background-color: #2980b9; }
        .btn-check { background-color: #27ae60; }
        .btn:hover { opacity: 0.9; }

        /* ê²°ê³¼ ìƒíƒœ ë°” */
        .status-bar {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            display: none; /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
        }
        .status-success { background-color: #2ecc71; }
        .status-fail { background-color: #e74c3c; }

        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
        .dashboard {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 15px;
            display: none; /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
        }

        .card {
            flex: 1;
            background: #dfe6e9;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .card h3 { margin: 0; font-size: 2rem; color: #2c3e50; }
        .card p { margin: 5px 0 0; font-size: 0.8rem; color: #7f8c8d; text-transform: uppercase; }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            margin-top: 25px;
            overflow-x: auto;
            background: white;
            border-radius: 8px;
            box-shadow: var(--box-shadow);
            display: none; /* ì´ˆê¸°ì—” ìˆ¨ê¹€ */
        }

        table {
            width: 1000px; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ì„ ìœ„í•´ ê³ ì • í­ ì„¤ì • ê°€ëŠ¥ */
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: #2c3e50;
            color: white;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        /* ì§ìˆ˜ í–‰ ë°°ê²½ìƒ‰ */
        tbody tr:nth-child(even) { background-color: #f9f9f9; }
        
        /* ë¯¸ì • ë‚ ì§œ ê°•ì¡° (ë¹¨ê°„ ë°°ê²½) */
        .date-tbd { background-color: #fadbd8; color: #c0392b; font-weight: bold; }
        .date-fixed { background-color: #d4efdf; color: #27ae60; font-weight: bold; }

        /* ì»¨í…Œì´ë„ˆ ë¯¸ì • ê°•ì¡° */
        .container-tbd { background-color: #fef9e7; color: #f39c12; font-weight: bold; }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        #loading { display: none; text-align: center; margin: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸšš STO373 Goods Arrival Plan Search</h1>
    </div>

    <div class="search-card">
        <label for="itemInput"><strong>ğŸ“¦ ItemNo (8 digits):</strong></label>
        <div class="input-group">
            <input type="text" id="itemInput" placeholder="Enter Item No (e.g. 00551172)" maxlength="8">
        </div>
        
        <div class="info-box">
            <i class="fas fa-info-circle"></i> ëª¨ë“  ë°°ì†¡ ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤ (ê³¼ê±°/í˜„ì¬/ë¯¸ë˜ í¬í•¨)<br>
            <i class="fas fa-lightbulb"></i> ì•ì— 0ì´ í¬í•¨ëœ 8ìë¦¬ ë²ˆí˜¸ë„ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ì˜ˆ: 00551172)<br>
            <i class="fas fa-search"></i> ì§§ì€ ë²ˆí˜¸ëŠ” ìë™ìœ¼ë¡œ 8ìë¦¬ë¡œ íŒ¨ë”©ë©ë‹ˆë‹¤ (ì˜ˆ: 123 â†’ 00000123)
        </div>

        <div>
            <button class="btn btn-search" onclick="performSearch()"><i class="fas fa-search"></i> SEARCH</button>
            <button class="btn btn-check" style="cursor: default;"><i class="fas fa-file-excel"></i> DATA LOADED</button>
        </div>
    </div>

    <div id="loading"><i class="fas fa-spinner fa-spin fa-2x"></i> ë°ì´í„° ê²€ìƒ‰ ì¤‘...</div>

    <div id="statusBar" class="status-bar"></div>

    <div id="dashboard" class="dashboard">
        <div class="card">
            <h3 id="totalResults">-</h3>
            <p>Total Results</p>
        </div>
        <div class="card">
            <h3 id="futureDeliveryQty">0</h3>
            <p>Future Delivery (Qty)</p>
        </div>
        <div class="card">
            <h3 id="nextDeliveryDate">-</h3>
            <p>Next Delivery</p>
        </div>
    </div>

    <div id="tableContainer" class="table-container">
        <table>
            <thead>
                <tr>
                    <th>HFB</th>
                    <th>ITEMNO</th>
                    <th>ITEMNAME</th>
                    <th>EDS</th>
                    <th>PLANNED DATE</th>
                    <th>QUANTITY (í•©ê³„)</th>
                    <th>CONTAINER</th>
                </tr>
            </thead>
            <tbody id="resultBody">
                </tbody>
        </table>
    </div>
</div>

<script>
    // ì—‘ì…€ ë°ì´í„°ê°€ ì €ì¥ë  ë³€ìˆ˜
    let excelData = [];
    const EXCEL_FILE_URL = './STO373 Goods arrival plan.xlsx'; // GitHub ì €ì¥ì†Œì— ì—…ë¡œë“œëœ íŒŒì¼ëª…ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì—‘ì…€ íŒŒì¼ ì½ê¸° ì‹œë„
    window.onload = async function() {
        try {
            const response = await fetch(EXCEL_FILE_URL);
            if (!response.ok) throw new Error("Excel file not found");
            const arrayBuffer = await response.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            
            // ì‹œíŠ¸ ì´ë¦„ í™•ì¸: [Orderinformation] ì‹œíŠ¸ë¥¼ ì°¾ìŒ
            let sheetName = workbook.SheetNames.find(name => name.toLowerCase().includes("orderinformation"));
            if (!sheetName) sheetName = workbook.SheetNames[0]; // ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì‹œíŠ¸ ì‚¬ìš©

            const worksheet = workbook.Sheets[sheetName];
            
            // JSONìœ¼ë¡œ ë³€í™˜ (ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ì¸ì‹)
            // í—¤ë”ê°€ 1í–‰ì— ìˆë‹¤ê³  ê°€ì •. ë§Œì•½ 2í–‰ë¶€í„°ë¼ë©´ range ì˜µì…˜ ì¡°ì • í•„ìš”
            excelData = XLSX.utils.sheet_to_json(worksheet, { defval: "" }); 
            
            console.log("Data loaded successfully. Total rows:", excelData.length);
        } catch (error) {
            console.error("Error loading Excel:", error);
            alert("ë°ì´í„° íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. GitHub ì €ì¥ì†Œì— ì—‘ì…€ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    };

    // ì—”í„°í‚¤ ì…ë ¥ ì‹œ ê²€ìƒ‰ íŠ¸ë¦¬ê±°
    document.getElementById('itemInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') performSearch();
    });

    function performSearch() {
        const inputRaw = document.getElementById('itemInput').value.trim();
        if (!inputRaw) {
            alert("ì œí’ˆë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // 8ìë¦¬ íŒ¨ë”© ì²˜ë¦¬ (ì˜ˆ: 123 -> 00000123)
        const searchItemNo = inputRaw.padStart(8, '0');
        
        document.getElementById('loading').style.display = 'block';
        
        // UI ì´ˆê¸°í™”
        document.getElementById('statusBar').style.display = 'none';
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('tableContainer').style.display = 'none';
        document.getElementById('resultBody').innerHTML = '';

        setTimeout(() => {
            // ê²€ìƒ‰ ë¡œì§ ì‹¤í–‰
            const results = searchExcel(searchItemNo);
            displayResults(results);
            document.getElementById('loading').style.display = 'none';
        }, 300); // UI ë°˜ì‘ì„ ìœ„í•œ ì§§ì€ ì§€ì—°
    }

    function searchExcel(targetItemNo) {
        // ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ìš© ë§µ (ì¤‘ë³µ ë³‘í•©ì„ ìœ„í•¨)
        // Key: Container + PlannedDate
        const groupedResults = {};

        /* ì—‘ì…€ ì»¬ëŸ¼ ë§¤í•‘ (SheetJSëŠ” A, B, C ëŒ€ì‹  í—¤ë” ì´ë¦„ì´ë‚˜ ì¸ë±ìŠ¤ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ, 
           ì—¬ê¸°ì„œëŠ” í—¤ë” ì´ë¦„ì„ ëª¨ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ Object.keysë‚˜ ìˆœì„œë¥¼ ì¶”ì •í•´ì•¼ í•¨.
           ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì€ ì—‘ì…€ì˜ ì—´ ì•ŒíŒŒë²³ì„ ì¸ë±ìŠ¤ë¡œ ë§¤í•‘í•˜ëŠ” ê²ƒì„.
           
           A=0, B=1(Container), C=2(ItemName), E=4(ItemNo), F=5(HFB), G=6(SSD), H=7(EDS), M=12(PlannedDate), P=15(Qty)
           í•˜ì§€ë§Œ json ë³€í™˜ ì‹œ keyëŠ” í—¤ë” í…ìŠ¤íŠ¸ê°€ ë¨. 
           ë”°ë¼ì„œ ì•ˆì „í•˜ê²Œ ëª¨ë“  rowë¥¼ ìˆœíšŒí•˜ë©° ê°’ì„ ì°¾ìŒ.
        */
        
        // í—¤ë” ì´ë¦„ì„ ëª¨ë¥´ë¯€ë¡œ, ì²« ë²ˆì§¸ rowì˜ keyë“¤ì„ ê°€ì ¸ì™€ì„œ ë§¤í•‘í•  ìˆ˜ë„ ìˆìœ¼ë‚˜,
        // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ í•˜ê¸° ìœ„í•´ ë°ì´í„°ê°€ ì˜¬ë°”ë¥¸ ì—´ ìˆœì„œë¡œ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì²˜ë¦¬í•˜ê±°ë‚˜,
        // ì‚¬ìš©ìê°€ ì œê³µí•œ "Eì—´", "Bì—´" ë“±ì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì²˜ë¦¬.
        // SheetJSì˜ sheet_to_jsonì€ í—¤ë”ëª…ì„ í‚¤ë¡œ ì‚¬ìš©í•¨.
        // ì •í™•ë„ë¥¼ ìœ„í•´ sheet_to_json ëŒ€ì‹  sheet_to_json with header: 'A' ì˜µì…˜ì„ ì“°ëŠ” ê²Œ ë‚˜ì„ ìˆ˜ë„ ìˆìŒ.
        // í•˜ì§€ë§Œ ì´ë¯¸ ë¡œë“œëœ excelDataë¥¼ ì”ë‹ˆë‹¤. ì—¬ê¸°ì„œ key ì´ë¦„ì„ ì¶”ì¸¡í•´ì•¼ í•¨.
        
        // ğŸš¨ ì¤‘ìš”: ì‹¤ì œ ì—‘ì…€ íŒŒì¼ì˜ í—¤ë” ì´ë¦„(1í–‰)ì„ ì •í™•íˆ ì•Œë©´ `row['HeaderName']`ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥.
        // ì—¬ê¸°ì„œëŠ” ì•ˆì „í•˜ê²Œ Object.values(row)[index] ë°©ì‹ì„ ì“¸ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ(JSON ë³€í™˜ ì‹œ ë¹ˆ ì…€ì´ ìƒëµë  ìˆ˜ ìˆìŒ),
        // ë¡œì§ ë‚´ì—ì„œ keyë¥¼ ì°¾ì•„ì•¼ í•¨. 
        // ğŸ’¡ ê°€ì¥ ì¢‹ì€ ë°©ë²•: sheet_to_json ì˜µì…˜ì—ì„œ { header: "A" }ë¥¼ ì‚¬ìš©í•˜ë©´ ì»¬ëŸ¼ëª…ì´ A, B, C... ê°€ ë¨.
        
        // ë¡œë“œ í•¨ìˆ˜ ìˆ˜ì •ì´ í•„ìš” ì—†ë„ë¡ ì—¬ê¸°ì„œ ì²˜ë¦¬ ë¡œì§ë§Œ ë³€ê²½:
        // í˜„ì¬ excelDataëŠ” header textë¥¼ keyë¡œ ê°€ì§. 
        // ì—‘ì…€ íŒŒì¼ì˜ ì‹¤ì œ í—¤ë”ëª…ì„ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ {header: "A"}ë¡œ ë‹¤ì‹œ íŒŒì‹±í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ì§€ ì•Šê³ ,
        // ë‹¨ìˆœíˆ "ê°’ì´ ìˆëŠ”ì§€ í™•ì¸"í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰.
        
        // í•˜ì§€ë§Œ ë°ì´í„° ì •í™•ì„±ì„ ìœ„í•´, í˜ì´ì§€ ë¡œë“œ ì‹œ {header:"A"}ë¡œ ì½ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•¨.
        // ìœ„ onload í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì—¬ê¸°ì„œ ë‹¤ì‹œ íŒŒì‹±í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, 
        // ê°€ìƒì˜ ë¡œì§: ì‚¬ìš©ìê°€ ì œê³µí•œ ìœ„ì¹˜(B, E, M ë“±)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§.
        // ë¬¸ì œëŠ” JSON ë³€í™˜ ì‹œ Keyê°€ Columnëª…ì´ ë¨.
        
        // ğŸ‘‰ í•´ê²°ì±…: ì´ ì½”ë“œë¥¼ ì‹¤ì œ ë°°í¬í•  ë•ŒëŠ” ì•„ë˜ `mapping` ê°ì²´ì˜ í‚¤ ê°’ì„ ì‹¤ì œ ì—‘ì…€ íŒŒì¼ì˜ 1í–‰(í—¤ë”) ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ê±°ë‚˜,
        // ì•„ë˜ onload ë¡œì§ì„ ìˆ˜ì •í•˜ì—¬ header: "A"ë¡œ ì½ë„ë¡ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤. (ì•„ë˜ ìˆ˜ì •ëœ ë¡œì§ ì ìš©)
    }
</script>

<script>
    let rawData = []; // ì»¬ëŸ¼ëª… A, B, C... ë¡œ ëœ ë°ì´í„°

    window.onload = async function() {
        try {
            const response = await fetch(EXCEL_FILE_URL);
            if (!response.ok) throw new Error("Excel file not found");
            const arrayBuffer = await response.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            
            let sheetName = workbook.SheetNames.find(name => name.toLowerCase().includes("orderinformation"));
            if (!sheetName) sheetName = workbook.SheetNames[0];

            const worksheet = workbook.Sheets[sheetName];
            
            // ì¤‘ìš”: header: "A" ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ A, B, C... í‚¤ë¥¼ ìƒì„±
            // range: 1 ì€ 1í–‰(í—¤ë”)ì„ ê±´ë„ˆë›°ê³  2í–‰ë¶€í„° ë°ì´í„°ë¡œ ì½ê² ë‹¤ëŠ” ì˜ë¯¸
            rawData = XLSX.utils.sheet_to_json(worksheet, { header: "A", defval: "", range: 1 }); 
            console.log("Data loaded via column-index. Count:", rawData.length);

        } catch (error) {
            console.error(error);
            // ë°ëª¨ë¥¼ ìœ„í•´ ë”ë¯¸ ë°ì´í„°ë¥¼ ë„£ì–´ë‘˜ ìˆ˜ë„ ìˆìŒ (ì„ íƒ ì‚¬í•­)
        }
    };

    function searchExcel(targetItemNo) {
        const groupedMap = new Map();

        // í•„í„°ë§ ë° ë°ì´í„° ê°€ê³µ
        rawData.forEach(row => {
            // Eì—´: ItemNo (ë¬¸ìì—´ ë³€í™˜ ë° ê³µë°± ì œê±°)
            let itemNo = String(row['E'] || "").trim();
            
            // ë¹„êµ (ë‘˜ ë‹¤ 8ìë¦¬ íŒ¨ë”©ëœ ë¬¸ìì—´ì´ë¼ê³  ê°€ì •í•˜ê±°ë‚˜, í¬í•¨ ì—¬ë¶€ í™•ì¸)
            // ì—¬ê¸°ì„œëŠ” ì •í™•í•œ ì¼ì¹˜ë¥¼ ì›ì¹™ìœ¼ë¡œ í•¨
            if (itemNo === targetItemNo) {

                // ë°ì´í„° ì¶”ì¶œ
                let container = String(row['B'] || "").trim();
                let itemName = row['C'] || "";
                let hfb = row['F'] || "";
                let ssd = row['G'] || ""; // ë‚ ì§œ í˜•ì‹ì¼ ìˆ˜ ìˆìŒ
                let eds = row['H'] || "";
                let plannedDateRaw = row['M']; 
                let qty = parseFloat(row['P']) || 0;

                // ë‚ ì§œ ì²˜ë¦¬ (Excel Serial Date -> JS Date -> String)
                let plannedDateStr = "ë¯¸ì •";
                let plannedDateObj = null;

                if (plannedDateRaw) {
                    if (typeof plannedDateRaw === 'number') {
                        // Excel Serial Date to JS Date
                        plannedDateObj = new Date(Math.round((plannedDateRaw - 25569) * 86400 * 1000));
                    } else {
                        // ë¬¸ìì—´ì¸ ê²½ìš°
                        plannedDateObj = new Date(plannedDateRaw);
                    }
                    
                    if (!isNaN(plannedDateObj)) {
                        // YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                        const yyyy = plannedDateObj.getFullYear();
                        const mm = String(plannedDateObj.getMonth() + 1).padStart(2, '0');
                        const dd = String(plannedDateObj.getDate()).padStart(2, '0');
                        plannedDateStr = `${yyyy}-${mm}-${dd}`;
                    } else {
                        plannedDateStr = "ë¯¸ì •";
                        plannedDateObj = null; // ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ
                    }
                }

                // ì»¨í…Œì´ë„ˆ ì²˜ë¦¬
                if (container === "") container = "ë°°ì†¡ì¤€ë¹„ì¤‘";

                // ê·¸ë£¹í•‘ í‚¤: ì»¨í…Œì´ë„ˆ + ë‚ ì§œ (ê°™ì€ ì»¨í…Œì´ë„ˆì— ê°™ì€ ë‚ ì§œë©´ ìˆ˜ëŸ‰ í•©ì‚°)
                // ë§Œì•½ ì»¨í…Œì´ë„ˆê°€ 'ë°°ì†¡ì¤€ë¹„ì¤‘'ì´ë¼ë©´ ë‚ ì§œë³„ë¡œ ë¬¶ìŒ
                const key = `${container}_${plannedDateStr}`;

                if (groupedMap.has(key)) {
                    const existing = groupedMap.get(key);
                    existing.quantity += qty;
                } else {
                    groupedMap.set(key, {
                        hfb: hfb,
                        itemNo: itemNo,
                        itemName: itemName,
                        ssd: ssd, // ì„œì‹ ë³€í™˜ í•„ìš” ì‹œ ì¶”ê°€ ë¡œì§
                        eds: eds,
                        plannedDateStr: plannedDateStr,
                        plannedDateObj: plannedDateObj, // ì •ë ¬ ë° ë¹„êµìš©
                        quantity: qty,
                        container: container
                    });
                }
            }
        });

        return Array.from(groupedMap.values());
    }

    function displayResults(results) {
        const statusBar = document.getElementById('statusBar');
        const dashboard = document.getElementById('dashboard');
        const tableContainer = document.getElementById('tableContainer');
        const tbody = document.getElementById('resultBody');

        // 1. ìƒíƒœ ë©”ì‹œì§€
        statusBar.style.display = 'block';
        if (results.length > 0) {
            statusBar.textContent = `âœ… ${results.length}ê°œì˜ ë°°ì†¡ ê³„íšì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!`;
            statusBar.className = 'status-bar status-success';
            dashboard.style.display = 'flex';
            tableContainer.style.display = 'block';
        } else {
            statusBar.textContent = 'âŒ ê²€ìƒ‰ ê²°ê³¼ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
            statusBar.className = 'status-bar status-fail';
            return; // ê²°ê³¼ ì—†ìœ¼ë©´ ì¤‘ë‹¨
        }

        // 2. ëŒ€ì‹œë³´ë“œ ê³„ì‚°
        // Total Results
        document.getElementById('totalResults').innerText = results.length;

        // Future & Next Delivery ê³„ì‚°
        // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€
        const today = new Date();
        today.setHours(0,0,0,0);

        // ë‚ ì§œê°€ ìˆê³  ì˜¤ëŠ˜ ì´í›„ì¸ ê²ƒë“¤ë§Œ í•„í„°ë§
        const futureDeliveries = results.filter(r => r.plannedDateObj && r.plannedDateObj >= today);
        
        // ë‚ ì§œìˆœ ì •ë ¬
        futureDeliveries.sort((a, b) => a.plannedDateObj - b.plannedDateObj);

        if (futureDeliveries.length > 0) {
            // ê°€ì¥ ê°€ê¹Œìš´ ë‚ ì§œ
            const nextDate = futureDeliveries[0].plannedDateStr;
            
            // ê°€ì¥ ê°€ê¹Œìš´ ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  ê±´ì˜ ìˆ˜ëŸ‰ í•©ê³„
            const nextDateItems = futureDeliveries.filter(r => r.plannedDateStr === nextDate);
            const totalNextQty = nextDateItems.reduce((sum, item) => sum + item.quantity, 0);

            document.getElementById('futureDeliveryQty').innerText = totalNextQty;
            document.getElementById('nextDeliveryDate').innerText = nextDate;
        } else {
            document.getElementById('futureDeliveryQty').innerText = "0";
            document.getElementById('nextDeliveryDate').innerText = "-";
        }

        // 3. í…Œì´ë¸” ë Œë”ë§
        // ë‚ ì§œê°€ í™•ì •ëœ ê²ƒì„ ìœ„ë¡œ, ë¯¸ì •ì€ ì•„ë˜ë¡œ, ë‚ ì§œìˆœ ì •ë ¬
        results.sort((a, b) => {
            if (a.plannedDateStr === "ë¯¸ì •") return 1;
            if (b.plannedDateStr === "ë¯¸ì •") return -1;
            return a.plannedDateObj - b.plannedDateObj;
        });

        results.forEach(row => {
            const tr = document.createElement('tr');
            
            // ë‚ ì§œ ìŠ¤íƒ€ì¼ë§
            let dateClass = row.plannedDateStr === "ë¯¸ì •" ? "date-tbd" : "date-fixed";
            
            // ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ë§
            let containerClass = row.container === "ë°°ì†¡ì¤€ë¹„ì¤‘" ? "container-tbd" : "";
            
            // EDS ì²˜ë¦¬ (ë‚ ì§œ í¬ë§·ì´ ì—‘ì…€ ìˆ«ìë¡œ ì˜¬ ê²½ìš° ë³€í™˜ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥, í˜„ì¬ëŠ” raw ê°’)
            // ê°„ë‹¨í•˜ê²Œ í…ìŠ¤íŠ¸ë¡œ ì¶œë ¥
            
            tr.innerHTML = `
                <td>${row.hfb}</td>
                <td>${row.itemNo}</td>
                <td>${row.itemName}</td>
                <td>${row.eds || '-'}</td>
                <td class="${dateClass}">${row.plannedDateStr}</td>
                <td style="font-weight:bold;">${row.quantity}</td>
                <td class="${containerClass}">${row.container}</td>
            `;
            tbody.appendChild(tr);
        });
    }
</script>

</body>
</html>